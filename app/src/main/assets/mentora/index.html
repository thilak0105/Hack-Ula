<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="./favicon.ico"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="Web site created using create-react-app"/>
    <link rel="apple-touch-icon" href="./logo192.png"/>
    <link rel="manifest" href="./manifest.json"/>
    <title>React App</title>
    <script>
        // Navigation Fix - Android Integration
        console.log('[AndroidBridge] Initializing...');

        // Flag that we're on Android
        window.isAndroidApp = true;

        // Store pending XHR requests to handle them
        const pendingRequests = new Map();
        let requestIdCounter = 0;

        // Callback handler for website extraction
        window.handleWebsiteExtraction = function(requestId, result) {
            console.log('[AndroidBridge] Website extraction complete:', result);
            const xhr = pendingRequests.get(requestId);
            if (xhr) {
                const responseText = JSON.stringify({
                    success: result.success,
                    course_id: 'android-' + Date.now(),
                    extracted_text: result.text || '',
                    course: {
                        title: result.title || 'Untitled Course',
                        description: 'Extracted from: ' + result.url,
                        lessons: []
                    },
                    message: result.success ? 'Content extracted successfully' : result.error
                });
                
                // Set response properties
                Object.defineProperty(xhr, 'readyState', { writable: true, value: 4 });
                Object.defineProperty(xhr, 'status', { writable: true, value: result.success ? 200 : 500 });
                Object.defineProperty(xhr, 'statusText', { writable: true, value: result.success ? 'OK' : 'Error' });
                Object.defineProperty(xhr, 'response', { writable: true, value: responseText });
                Object.defineProperty(xhr, 'responseText', { writable: true, value: responseText });
                Object.defineProperty(xhr, 'responseType', { writable: true, value: 'text' });
                
                // Create proper response headers
                const mockHeaders = 'Content-Type: application/json\r\n';
                xhr.getAllResponseHeaders = () => mockHeaders;
                xhr.getResponseHeader = (name) => {
                    if (name.toLowerCase() === 'content-type') return 'application/json';
                    return null;
                };
                
                // Trigger events
                if (xhr.onreadystatechange) xhr.onreadystatechange({ target: xhr });
                if (xhr.onload) xhr.onload({ target: xhr });
                
                pendingRequests.delete(requestId);
            }
        };

        // Override XMLHttpRequest for axios
        const OriginalXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new OriginalXHR();
            const originalOpen = xhr.open;
            const originalSend = xhr.send;
            
            xhr.open = function(method, url, ...args) {
                this._method = method;
                this._url = url;
                
                // Check if this is an upload/api call
                if (url.includes('localhost') || url.includes('/api/') || url.includes('/upload')) {
                    this._shouldIntercept = true;
                    console.log('[AndroidBridge] Will intercept:', method, url);
                }
                
                return originalOpen.call(this, method, url, ...args);
            };
            
            xhr.send = function(data) {
                if (this._shouldIntercept) {
                    console.log('[AndroidBridge] Intercepting request to:', this._url);
                    
                    // Check if FormData contains a URL
                    let websiteUrl = null;
                    if (data instanceof FormData) {
                        websiteUrl = data.get('url');
                    }
                    
                    if (websiteUrl && window.Android && window.Android.extractWebsiteContent) {
                        // Use Android to extract real website content!
                        console.log('[AndroidBridge] Extracting content from:', websiteUrl);
                        const requestId = requestIdCounter++;
                        pendingRequests.set(requestId, this);
                        
                        // Call Android method to extract website
                        window.Android.extractWebsiteContent(
                            websiteUrl,
                            `handleWebsiteExtraction.bind(null, ${requestId})`
                        );
                    } else {
                        // No URL provided, return mock/skip
                        console.log('[AndroidBridge] No URL provided, using mock data');
                        setTimeout(() => {
                            const mockData = {
                                success: true,
                                course_id: 'android-mock-' + Date.now(),
                                extracted_text: 'No content provided. Please enter a website URL.',
                                course: { title: 'Sample Course', lessons: [] },
                                message: 'Skipped - No URL provided'
                            };
                            const responseText = JSON.stringify(mockData);
                            
                            Object.defineProperty(this, 'readyState', { writable: true, value: 4 });
                            Object.defineProperty(this, 'status', { writable: true, value: 200 });
                            Object.defineProperty(this, 'statusText', { writable: true, value: 'OK' });
                            Object.defineProperty(this, 'response', { writable: true, value: responseText });
                            Object.defineProperty(this, 'responseText', { writable: true, value: responseText });
                            Object.defineProperty(this, 'responseType', { writable: true, value: 'text' });
                            
                            const mockHeaders = 'Content-Type: application/json\r\n';
                            this.getAllResponseHeaders = () => mockHeaders;
                            this.getResponseHeader = (name) => {
                                if (name.toLowerCase() === 'content-type') return 'application/json';
                                return null;
                            };
                            
                            if (this.onreadystatechange) this.onreadystatechange({ target: this });
                            if (this.onload) this.onload({ target: this });
                        }.bind(this), 200);
                    }
                    
                    return;
                }
                
                return originalSend.call(this, data);
            };
            
            return xhr;
        };

        console.log('[AndroidBridge] Ready! Website extraction enabled.');
    </script>
    <script defer="defer" src="./static/js/main.9dbe6570.js"></script>
    <link href="./static/css/main.e6c13ad2.css" rel="stylesheet">
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>
</body>
</html>