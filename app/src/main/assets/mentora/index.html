<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="./favicon.ico"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="theme-color" content="#6366F1"/>
    <meta name="description" content="Mentora Mobile - AI-Powered Course Generator"/>
    <link rel="apple-touch-icon" href="./logo192.png"/>
    <link rel="manifest" href="./manifest.json"/>
    <title>Mentora Mobile</title>

    <style>
        /* ========== RESPONSIVE FIXES & MOBILE-FIRST STYLING ========== */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 
                         'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        
        #root {
            width: 100%;
            min-height: 100vh;
            padding-bottom: 70px; /* Space for bottom navigation */
            background: #F9FAFB;
        }
        
        /* Fix container widths */
        .container, .main-container, [class*="container"] {
            max-width: 100vw !important;
            padding-left: 16px !important;
            padding-right: 16px !important;
            margin-left: auto !important;
            margin-right: auto !important;
        }
        
        /* Responsive images */
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Fix forms and inputs */
        input, textarea, select, button {
            max-width: 100%;
            font-size: 16px; /* Prevents zoom on iOS */
        }
        
        /* ========== BOTTOM NAVIGATION ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            padding: 0 4px;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            cursor: pointer;
            text-decoration: none;
            color: #9CA3AF;
            transition: all 0.3s ease;
            border-radius: 8px;
            min-width: 0;
        }
        
        .nav-item:active {
            background: #F3F4F6;
        }
        
        .nav-item.active {
            color: #6366F1;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        /* ========== SECTION CONTAINERS ========== */
        .section {
            display: none;
            padding: 16px;
            min-height: calc(100vh - 70px);
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-header {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
            padding-top: 8px;
        }
        
        /* ========== CARD STYLING ========== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* ========== RESPONSIVE BREAKPOINTS ========== */
        @media (max-width: 768px) {
            .section {
                padding: 12px;
            }
            
            .section-header {
                font-size: 20px;
            }
            
            .nav-label {
                font-size: 10px;
            }
            
            .nav-icon {
                font-size: 20px;
            }
        }
        
        @media (max-width: 360px) {
            .bottom-nav {
                height: 60px;
            }
            
            #root {
                padding-bottom: 60px;
            }
            
            .nav-icon {
                font-size: 18px;
                margin-bottom: 2px;
            }
            
            .nav-label {
                font-size: 9px;
            }
        }
        
        /* Hide original React root initially for smooth transition */
        #root > div {
            max-width: 100% !important;
        }
    </style>

    <script>
        // Android Bridge - Must load BEFORE React app
        console.log('[AndroidBridge] Initializing...');
        
        window.isAndroidApp = true;
        
        // Store pending requests
        const pendingXHR = new Map();
        let xhrId = 0;
        
        // Handler for website extraction results
        window.handleWebResult = function(id, result) {
            console.log('[AndroidBridge] Got result for request', id, result);
            const xhr = pendingXHR.get(id);
            if (!xhr) {
                console.error('[AndroidBridge] No XHR found for request', id);
                return;
            }
            
            // Create proper response structure matching frontend expectations
            const data = {
                success: result.success || false,
                course_id: 'android-' + Date.now(),
                extracted_text: result.text || '',
                course: {
                    title: result.title || 'Untitled Course',
                    description: 'Course created from extracted content',
                    modules: [
                        {
                            id: 'module-1',
                            title: 'Introduction',
                            description: 'Getting started',
                            duration: 60,
                            lessonCount: 2,
                            status: 'in-progress',
                            lessons: [
                                {
                                    id: 'lesson-1-1',
                                    title: 'What is ' + (result.title || 'this topic') + '?',
                                    description: 'Introduction and overview',
                                    duration: 30,
                                    status: 'in-progress'
                                },
                                {
                                    id: 'lesson-1-2',
                                    title: 'Key Concepts',
                                    description: 'Understanding the fundamentals',
                                    duration: 30,
                                    status: 'available'
                                }
                            ]
                        }
                    ]
                }
            };
            
            console.log('[AndroidBridge] Responding with:', data);
            const json = JSON.stringify(data);
            
            Object.defineProperty(xhr, 'readyState', {writable: true, value: 4});
            Object.defineProperty(xhr, 'status', {writable: true, value: result.success ? 200 : 500});
            Object.defineProperty(xhr, 'statusText', {writable: true, value: result.success ? 'OK' : 'Error'});
            Object.defineProperty(xhr, 'response', {writable: true, value: json});
            Object.defineProperty(xhr, 'responseText', {writable: true, value: json});
            Object.defineProperty(xhr, 'responseType', {writable: true, value: ''});
            
            xhr.getAllResponseHeaders = () => 'Content-Type: application/json\r\n';
            xhr.getResponseHeader = (n) => n.toLowerCase() === 'content-type' ? 'application/json' : null;
            
            console.log('[AndroidBridge] Triggering events...');
            
            // Trigger readystatechange first
            if (xhr.onreadystatechange) {
                try {
                    xhr.onreadystatechange({type: 'readystatechange', target: xhr});
                    console.log('[AndroidBridge] onreadystatechange triggered');
                } catch(e) {
                    console.error('[AndroidBridge] Error in onreadystatechange:', e);
                }
            }
            
            // Then trigger onload
            if (xhr.onload) {
                try {
                    xhr.onload({type: 'load', target: xhr, currentTarget: xhr});
                    console.log('[AndroidBridge] onload triggered');
                } catch(e) {
                    console.error('[AndroidBridge] Error in onload:', e);
                }
            }
            
            // Also try loadend
            if (xhr.onloadend) {
                try {
                    xhr.onloadend({type: 'loadend', target: xhr});
                    console.log('[AndroidBridge] onloadend triggered');
                } catch(e) {
                    console.error('[AndroidBridge] Error in onloadend:', e);
                }
            }
            
            pendingXHR.delete(id);
            console.log('[AndroidBridge] Request', id, 'completed');
        };
        
        // Override XMLHttpRequest
        const RealXHR = window.XMLHttpRequest;
        window.XMLHttpRequest = function() {
            const xhr = new RealXHR();
            const realOpen = xhr.open;
            const realSend = xhr.send;
            
            xhr.open = function(method, url) {
                this._url = url;
                this._intercept = url.includes('localhost') || url.includes('/upload');
                if (this._intercept) console.log('[AndroidBridge] Intercepting:', url);
                return realOpen.apply(this, arguments);
            };
            
            xhr.send = function(data) {
                if (!this._intercept) return realSend.call(this, data);
                
                console.log('[AndroidBridge] Handling intercepted request:', this._url);
                
                let url = null;
                if (data && data.get) url = data.get('url');
                
                // Check if this is a lesson content request
                const isLessonContent = this._url.includes('lesson-content') || this._url.includes('/lessons/');
                
                // Check if this is a course generation request
                const isCourseGeneration = this._url.includes('generate') || 
                                          this._url.includes('course') ||
                                          (!url && data && !isLessonContent);
                
                if (isLessonContent && window.Android && window.Android.generateLessonContent) {
                    // Generate lesson content using AI
                    console.log('[AndroidBridge] Generating lesson content with AI...');
                    
                    let lessonInfo = {
                        title: '',
                        description: '',
                        context: ''
                    };
                    
                    if (data && data.get) {
                        lessonInfo.title = data.get('title') || data.get('lessonTitle') || 'Lesson';
                        lessonInfo.description = data.get('description') || data.get('lessonDescription') || '';
                        lessonInfo.context = data.get('context') || data.get('courseContext') || '';
                    }
                    
                    console.log('[AndroidBridge] Lesson Info:', lessonInfo);
                    
                    const callbackName = 'lessonContentCallback_' + Date.now();
                    window[callbackName] = function(response) {
                        console.log('[AndroidBridge] Lesson content response:', response);
                        
                        const json = JSON.stringify(response);
                        Object.defineProperty(this, 'readyState', {writable: true, value: 4});
                        Object.defineProperty(this, 'status', {writable: true, value: response.success ? 200 : 500});
                        Object.defineProperty(this, 'response', {writable: true, value: json});
                        Object.defineProperty(this, 'responseText', {writable: true, value: json});
                        
                        this.getAllResponseHeaders = () => 'Content-Type: application/json\r\n';
                        this.getResponseHeader = () => 'application/json';
                        
                        if (this.onreadystatechange) this.onreadystatechange({type: 'readystatechange', target: this});
                        if (this.onload) this.onload({type: 'load', target: this});
                        if (this.onloadend) this.onloadend({type: 'loadend', target: this});
                        
                        console.log('[AndroidBridge] Lesson content generation complete!');
                        delete window[callbackName];
                    }.bind(this);
                    
                    window.Android.generateLessonContent(
                        lessonInfo.title,
                        lessonInfo.description,
                        lessonInfo.context,
                        callbackName
                    );
                    
                } else if (isCourseGeneration && window.Android && window.Android.generateCourseContent) {
                    // Use the unified course generation method
                    console.log('[AndroidBridge] Generating course with AI using unified method...');
                    
                    // Extract course details from FormData
                    let courseInfo = {
                        url: '',
                        extractedText: '',
                        title: 'Machine Learning',
                        difficulty: 'Beginner',
                        audience: 'Students',
                        prerequisites: 'None'
                    };
                    
                    if (data && data.get) {
                        courseInfo.url = data.get('url') || '';
                        courseInfo.extractedText = data.get('extracted_text') || '';
                        courseInfo.title = data.get('title') || courseInfo.title;
                        courseInfo.difficulty = data.get('difficulty') || courseInfo.difficulty;
                        courseInfo.audience = data.get('audience') || courseInfo.audience;
                        courseInfo.prerequisites = data.get('prerequisites') || courseInfo.prerequisites;
                    }
                    
                    console.log('[AndroidBridge] Course Info:', courseInfo);
                    
                    // Call unified generation method
                    const callbackName = 'courseGenCallback_' + Date.now();
                    window[callbackName] = function(response) {
                        console.log('[AndroidBridge] Course generation response:', response);
                        
                        // Transform AI response to match frontend structure
                        let finalResponse = {
                            success: response.success || false,
                            course_id: response.course_id || ('ai-' + Date.now()),
                            extracted_text: response.extracted_text || ''
                        };
                        
                        if (response.success && response.course) {
                            // Transform lessons to modules format
                            const lessons = response.course.lessons || [];
                            const modules = lessons.map((lesson, index) => ({
                                id: 'module-' + (index + 1),
                                title: lesson.title || ('Module ' + (index + 1)),
                                description: lesson.description || 'AI generated module',
                                duration: 60,
                                lessonCount: (lesson.topics || []).length,
                                status: index === 0 ? 'in-progress' : 'available',
                                lessons: (lesson.topics || ['Introduction', 'Core Concepts', 'Practice']).map((topic, tIndex) => ({
                                    id: `lesson-${index + 1}-${tIndex + 1}`,
                                    title: topic,
                                    description: lesson.description || 'Learn about ' + topic,
                                    duration: 20,
                                    status: index === 0 && tIndex === 0 ? 'in-progress' : 'available'
                                }))
                            }));
                            
                            finalResponse.course = {
                                title: response.course.title || 'AI Generated Course',
                                description: response.course.description || 'Course created with AI',
                                modules: modules.length > 0 ? modules : [
                                    {
                                        id: 'module-1',
                                        title: 'Introduction',
                                        description: 'Getting started',
                                        duration: 60,
                                        lessonCount: 2,
                                        status: 'in-progress',
                                        lessons: [
                                            {
                                                id: 'lesson-1-1',
                                                title: 'Overview',
                                                description: 'Course overview',
                                                duration: 30,
                                                status: 'in-progress'
                                            },
                                            {
                                                id: 'lesson-1-2',
                                                title: 'Getting Started',
                                                description: 'Begin your learning journey',
                                                duration: 30,
                                                status: 'available'
                                            }
                                        ]
                                    }
                                ]
                            };
                        } else {
                            // Error case - still provide valid structure
                            finalResponse.course = {
                                title: 'Error',
                                description: response.message || response.error || 'Failed to generate course',
                                modules: []
                            };
                        }
                        
                        const json = JSON.stringify(finalResponse);
                        Object.defineProperty(this, 'readyState', {writable: true, value: 4});
                        Object.defineProperty(this, 'status', {writable: true, value: response.success ? 200 : 500});
                        Object.defineProperty(this, 'response', {writable: true, value: json});
                        Object.defineProperty(this, 'responseText', {writable: true, value: json});
                        
                        this.getAllResponseHeaders = () => 'Content-Type: application/json\r\n';
                        this.getResponseHeader = () => 'application/json';
                        
                        if (this.onreadystatechange) this.onreadystatechange({type: 'readystatechange', target: this});
                        if (this.onload) this.onload({type: 'load', target: this});
                        if (this.onloadend) this.onloadend({type: 'loadend', target: this});
                        
                        console.log('[AndroidBridge] Course generation complete!');
                        delete window[callbackName];
                    }.bind(this);
                    
                    window.Android.generateCourseContent(
                        courseInfo.url,
                        courseInfo.extractedText,
                        courseInfo.title,
                        courseInfo.difficulty,
                        courseInfo.audience,
                        courseInfo.prerequisites,
                        callbackName
                    );
                    
                } else if (url && window.Android && window.Android.extractWebsiteContent) {
                    // Website extraction only (legacy path)
                    console.log('[AndroidBridge] Fetching:', url);
                    const id = xhrId++;
                    pendingXHR.set(id, this);
                    const callback = 'handleWebResult_' + id;
                    window[callback] = function(r) { window.handleWebResult(id, r); delete window[callback]; };
                    window.Android.extractWebsiteContent(url, callback);
                } else {
                    // No URL or Android, return mock
                    console.log('[AndroidBridge] No URL or Android not available, mocking');
                    setTimeout(function() {
                        const json = JSON.stringify({
                            success: true,
                            course_id: 'mock-' + Date.now(),
                            extracted_text: 'Please enter a website URL',
                            course: {
                                title: 'Sample Course',
                                description: 'A sample course for testing',
                                modules: [
                                    {
                                        id: 'module-1',
                                        title: 'Introduction',
                                        description: 'Getting started',
                                        duration: 60,
                                        lessonCount: 2,
                                        status: 'in-progress',
                                        lessons: [
                                            {
                                                id: 'lesson-1-1',
                                                title: 'Overview',
                                                description: 'Course overview',
                                                duration: 30,
                                                status: 'in-progress'
                                            },
                                            {
                                                id: 'lesson-1-2',
                                                title: 'Getting Started',
                                                description: 'Begin your learning journey',
                                                duration: 30,
                                                status: 'available'
                                            }
                                        ]
                                    }
                                ]
                            }
                        });
                        Object.defineProperty(this, 'readyState', {writable: true, value: 4});
                        Object.defineProperty(this, 'status', {writable: true, value: 200});
                        Object.defineProperty(this, 'response', {writable: true, value: json});
                        Object.defineProperty(this, 'responseText', {writable: true, value: json});
                        this.getAllResponseHeaders = () => 'Content-Type: application/json';
                        this.getResponseHeader = () => 'application/json';
                        if (this.onreadystatechange) this.onreadystatechange();
                        if (this.onload) this.onload();
                    }.bind(this), 200);
                }
            };
            
            return xhr;
        };
        
        // ========== Callback Management System ==========
        let callbackCounter = 0;
        const callbackRegistry = {};

        window.__registerCallback = function(fn) {
            const id = '__callback_' + (callbackCounter++);
            callbackRegistry[id] = fn;
            window[id] = function(...args) {
                try {
                    fn(...args);
                } finally {
                    // Clean up after single use
                    delete window[id];
                    delete callbackRegistry[id];
                }
            };
            return id;
        };

        window.__registerPersistentCallback = function(fn) {
            const id = '__callback_' + (callbackCounter++);
            callbackRegistry[id] = fn;
            window[id] = fn;
            return id;
        };

        // ========== Enhanced Android API Wrappers ==========
        
        // Wrap downloadModel to handle function callbacks
        if (window.Android && window.Android.downloadModel) {
            const originalDownloadModel = window.Android.downloadModel;
            window.Android.downloadModel = function(modelId, progressCallback, completeCallback) {
                console.log('[Bridge] downloadModel called with:', modelId);
                
                // If callbacks are functions, register them
                const progressCbName = typeof progressCallback === 'function' 
                    ? window.__registerPersistentCallback(progressCallback)
                    : progressCallback;
                
                const completeCbName = typeof completeCallback === 'function'
                    ? window.__registerCallback(completeCallback)
                    : completeCallback;
                
                console.log('[Bridge] Registered callbacks:', progressCbName, completeCbName);
                
                // Call original with string names
                return originalDownloadModel.call(this, modelId, progressCbName, completeCbName);
            };
        }

        // Wrap getAvailableModels to handle function callbacks
        if (window.Android && window.Android.getAvailableModels) {
            const originalGetAvailableModels = window.Android.getAvailableModels;
            window.Android.getAvailableModels = function(callback) {
                console.log('[Bridge] getAvailableModels called');
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalGetAvailableModels.call(this, callbackName);
            };
        }

        // Wrap loadModel to handle function callbacks
        if (window.Android && window.Android.loadModel) {
            const originalLoadModel = window.Android.loadModel;
            window.Android.loadModel = function(modelId, callback) {
                console.log('[Bridge] loadModel called with:', modelId);
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalLoadModel.call(this, modelId, callbackName);
            };
        }

        // Wrap generateText to handle function callbacks
        if (window.Android && window.Android.generateText) {
            const originalGenerateText = window.Android.generateText;
            window.Android.generateText = function(prompt, callback) {
                console.log('[Bridge] generateText called');
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalGenerateText.call(this, prompt, callbackName);
            };
        }

        // Wrap isModelLoaded to handle function callbacks
        if (window.Android && window.Android.isModelLoaded) {
            const originalIsModelLoaded = window.Android.isModelLoaded;
            window.Android.isModelLoaded = function(callback) {
                console.log('[Bridge] isModelLoaded called');
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalIsModelLoaded.call(this, callbackName);
            };
        }

        // Wrap generateCourseContent to handle function callbacks
        if (window.Android && window.Android.generateCourseContent) {
            const originalGenerateCourseContent = window.Android.generateCourseContent;
            window.Android.generateCourseContent = function(url, extractedText, courseTitle, difficulty, audience, prerequisites, callback) {
                console.log('[Bridge] generateCourseContent called');
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalGenerateCourseContent.call(this, url, extractedText, courseTitle, difficulty, audience, prerequisites, callbackName);
            };
        }

        // Wrap generateLessonContent to handle function callbacks
        if (window.Android && window.Android.generateLessonContent) {
            const originalGenerateLessonContent = window.Android.generateLessonContent;
            window.Android.generateLessonContent = function(lessonTitle, lessonDescription, courseContext, callback) {
                console.log('[Bridge] generateLessonContent called');
                
                const callbackName = typeof callback === 'function'
                    ? window.__registerCallback(callback)
                    : callback;
                
                return originalGenerateLessonContent.call(this, lessonTitle, lessonDescription, courseContext, callbackName);
            };
        }

        console.log('[AndroidBridge] Ready!');
    </script>
    <script defer="defer" src="./static/js/main.9dbe6570.js"></script>
    <link href="./static/css/main.e6c13ad2.css" rel="stylesheet">
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <div class="nav-item active" data-section="courses" onclick="switchSection('courses')">
        <div class="nav-icon">üìö</div>
        <div class="nav-label">Courses</div>
    </div>
    <div class="nav-item" data-section="upload" onclick="switchSection('upload')">
        <div class="nav-icon">üì§</div>
        <div class="nav-label">Upload</div>
    </div>
    <div class="nav-item" data-section="learner" onclick="switchSection('learner')">
        <div class="nav-icon">üë§</div>
        <div class="nav-label">Learner</div>
    </div>
    <div class="nav-item" data-section="path" onclick="switchSection('path')">
        <div class="nav-icon">üéØ</div>
        <div class="nav-label">Path</div>
    </div>
    <div class="nav-item" data-section="examine" onclick="switchSection('examine')">
        <div class="nav-icon">‚úçÔ∏è</div>
        <div class="nav-label">Examine</div>
    </div>
    <div class="nav-item" data-section="outcome" onclick="switchSection('outcome')">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">Outcome</div>
    </div>
</nav>

<script>
    // Section switching functionality
    function switchSection(sectionName) {
        console.log('[Navigation] Switching to:', sectionName);
        
        // Update navigation active state
        document.querySelectorAll('.nav-item').forEach(item => {
            if (item.dataset.section === sectionName) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
        
        // The React app will handle the actual content based on routing
        // For now, we're just providing the navigation UI
        // You can extend this to actually show/hide sections if needed
        
        // Optional: Store current section
        localStorage.setItem('currentSection', sectionName);
        
        // Optional: Trigger custom event that React can listen to
        window.dispatchEvent(new CustomEvent('sectionChange', { 
            detail: { section: sectionName } 
        }));
    }
    
    // Restore last active section on load
    document.addEventListener('DOMContentLoaded', function() {
        const lastSection = localStorage.getItem('currentSection') || 'courses';
        switchSection(lastSection);
        
        console.log('[Navigation] Navigation system ready!');
    });
    
    // Make navigation responsive to screen size changes
    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            // Recalculate layout if needed
            console.log('[Navigation] Screen resized to:', window.innerWidth, 'x', window.innerHeight);
        }, 250);
    });
    
    // Prevent zoom on double-tap for nav items
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
</script>
</body>
</html>